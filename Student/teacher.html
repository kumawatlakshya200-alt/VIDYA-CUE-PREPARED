import { useState, useCallback } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card';
import { Button } from './ui/button';
import { Badge } from './ui/badge';
import { Input } from './ui/input';
import { Label } from './ui/label';
import { Textarea } from './ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from './ui/dialog';
import { Checkbox } from './ui/checkbox';
import {
LayoutDashboard,
QrCode,
ClipboardList,
Calendar,
Bell,
BookOpen,
GraduationCap,
Settings,
LogOut,
Users,
Clock,
TrendingUp,
FileText,
Upload,
Download,
Search,
Filter,
Plus,
Edit,
Trash2,
Eye,
CheckCircle,
XCircle,
AlertCircle,
Moon,
Sun,
Menu,
X as CloseIcon,
ChevronDown,
BarChart3,
Award,
Mail,
Phone,
MapPin,
Briefcase,
Building2,
User,
UserCheck
} from 'lucide-react';
import QRCode from 'qrcode';
import { motion } from 'motion/react';

interface TeacherPortalProps {
userInfo: {
name: string;
email: string;
institute: string;
};
onLogout: () => void;
}

type PageType = 'dashboard' | 'qr-code' | 'assignments' | 'schedule' | 'grades' | 'attendance-view' | 'settings';

interface Assignment {
id: number;
title: string;
batch: string;
course: string;
dueDate: string;
totalMarks: number;
submissions: number;
totalStudents: number;
status: 'active' | 'closed' | 'draft';
description: string;
fileName?: string;
}

interface StudentSubmission {
studentId: number;
studentName: string;
rollNo: string;
email: string;
submitted: boolean;
submissionDate?: string;
fileName?: string;
marks?: number;
feedback?: string;
}

interface Course {
id: number;
name: string;
code: string;
students: number;
schedule: string;
room: string;
semester: string;
}

interface Notification {
id: number;
type: 'system' | 'student' | 'admin';
title: string;
message: string;
time: string;
read: boolean;
}

interface Grade {
studentId: number;
studentName: string;
rollNo: string;
course: string;
assignments: number;
midterm: number;
final: number;
total: number;
grade: string;
}

export function TeacherPortal({ userInfo, onLogout }: TeacherPortalProps) {
const [currentPage, setCurrentPage] = useState<PageType>('dashboard');
    const [theme, setTheme] = useState<'light' | 'dark'>('light');
        const [sidebarOpen, setSidebarOpen] = useState(true);
        const [qrCodeUrl, setQrCodeUrl] = useState<string>('');
            const [qrPurpose, setQrPurpose] = useState<'attendance' | 'assignment' | 'resource'>('attendance');
                const [selectedCourse, setSelectedCourse] = useState<string>('CSE-101');

                    // Assignment modal states
                    const [isCreateAssignmentOpen, setIsCreateAssignmentOpen] = useState(false);
                    const [isEditAssignmentOpen, setIsEditAssignmentOpen] = useState(false);
                    const [isViewAssignmentOpen, setIsViewAssignmentOpen] = useState(false);
                    const [selectedAssignment, setSelectedAssignment] = useState<Assignment | null>(null);
                        const [assignmentForm, setAssignmentForm] = useState({
                        title: '',
                        batch: '',
                        course: '',
                        dueDate: '',
                        description: '',
                        fileName: ''
                        });

                        // Attendance modal states
                        const [isMarkAttendanceOpen, setIsMarkAttendanceOpen] = useState(false);
                        const [selectedScheduleItem, setSelectedScheduleItem] = useState<any>(null);

                            // Filter states
                            const [selectedBatch, setSelectedBatch] = useState<string>('all');

                                // Mock data
                                const batches = ['B.Tech CSE - 3rd Sem', 'B.Tech CSE - 5th Sem', 'B.Tech CSE - 7th
                                Sem'];

                                const [assignments, setAssignments] = useState<Assignment[]>([
                                    {
                                    id: 1,
                                    title: 'Data Structures Lab 1',
                                    batch: 'B.Tech CSE - 3rd Sem',
                                    course: 'Data Structures',
                                    dueDate: '2024-12-01',
                                    totalMarks: 50,
                                    submissions: 28,
                                    totalStudents: 35,
                                    status: 'active',
                                    description: 'Implement stack and queue operations',
                                    fileName: 'DS_Lab1_Instructions.pdf'
                                    },
                                    {
                                    id: 2,
                                    title: 'Algorithm Analysis Project',
                                    batch: 'B.Tech CSE - 5th Sem',
                                    course: 'Algorithms',
                                    dueDate: '2024-12-05',
                                    totalMarks: 100,
                                    submissions: 15,
                                    totalStudents: 32,
                                    status: 'active',
                                    description: 'Analyze time complexity of sorting algorithms',
                                    fileName: 'Algorithm_Project.pdf'
                                    },
                                    {
                                    id: 3,
                                    title: 'Database Design Assignment',
                                    batch: 'B.Tech CSE - 7th Sem',
                                    course: 'Database Systems',
                                    dueDate: '2024-11-28',
                                    totalMarks: 75,
                                    submissions: 30,
                                    totalStudents: 30,
                                    status: 'closed',
                                    description: 'Design a relational database for library management',
                                    fileName: 'DB_Assignment.pdf'
                                    }
                                    ]);

                                    const studentSubmissions: StudentSubmission[] = [
                                    { studentId: 1, studentName: 'John Doe', rollNo: 'CSE001', email:
                                    'john@example.com', submitted: true, submissionDate: '2024-11-25', fileName:
                                    'john_submission.pdf', marks: 45 },
                                    { studentId: 2, studentName: 'Sarah Wilson', rollNo: 'CSE002', email:
                                    'sarah@example.com', submitted: true, submissionDate: '2024-11-26', fileName:
                                    'sarah_submission.pdf', marks: 42 },
                                    { studentId: 3, studentName: 'Mike Johnson', rollNo: 'CSE003', email:
                                    'mike@example.com', submitted: true, submissionDate: '2024-11-24', fileName:
                                    'mike_submission.pdf', marks: 48 },
                                    { studentId: 4, studentName: 'Emily Brown', rollNo: 'CSE004', email:
                                    'emily@example.com', submitted: false },
                                    { studentId: 5, studentName: 'David Lee', rollNo: 'CSE005', email:
                                    'david@example.com', submitted: false },
                                    { studentId: 6, studentName: 'Lisa Chen', rollNo: 'CSE006', email:
                                    'lisa@example.com', submitted: true, submissionDate: '2024-11-27', fileName:
                                    'lisa_submission.pdf', marks: 40 },
                                    { studentId: 7, studentName: 'Tom Anderson', rollNo: 'CSE007', email:
                                    'tom@example.com', submitted: false }
                                    ];

                                    const [attendanceList, setAttendanceList] = useState([
                                    { studentId: 1, studentName: 'John Doe', rollNo: 'CSE001', present: false },
                                    { studentId: 2, studentName: 'Sarah Wilson', rollNo: 'CSE002', present: false },
                                    { studentId: 3, studentName: 'Mike Johnson', rollNo: 'CSE003', present: false },
                                    { studentId: 4, studentName: 'Emily Brown', rollNo: 'CSE004', present: false },
                                    { studentId: 5, studentName: 'David Lee', rollNo: 'CSE005', present: false },
                                    { studentId: 6, studentName: 'Lisa Chen', rollNo: 'CSE006', present: false },
                                    { studentId: 7, studentName: 'Tom Anderson', rollNo: 'CSE007', present: false },
                                    { studentId: 8, studentName: 'Anna Smith', rollNo: 'CSE008', present: false },
                                    { studentId: 9, studentName: 'Chris Brown', rollNo: 'CSE009', present: false },
                                    { studentId: 10, studentName: 'Jessica Davis', rollNo: 'CSE010', present: false }
                                    ]);

                                    const [courses, setCourses] = useState<Course[]>([
                                        { id: 1, name: 'Data Structures', code: 'CSE-101', students: 35, schedule: 'Mon,
                                        Wed, Fri 9:00 AM', room: 'CS-201', semester: 'Fall 2024' },
                                        { id: 2, name: 'Algorithms', code: 'CSE-202', students: 32, schedule: 'Tue, Thu
                                        11:00 AM', room: 'CS-202', semester: 'Fall 2024' },
                                        { id: 3, name: 'Database Systems', code: 'CSE-303', students: 30, schedule:
                                        'Mon, Wed 2:00 PM', room: 'CS-203', semester: 'Fall 2024' },
                                        { id: 4, name: 'Software Engineering', code: 'CSE-401', students: 28, schedule:
                                        'Tue, Thu 4:00 PM', room: 'CS-204', semester: 'Fall 2024' }
                                        ]);

                                        const [notifications, setNotifications] = useState<Notification[]>([
                                            { id: 1, type: 'student', title: 'New Assignment Submission', message: 'John
                                            Doe submitted Data Structures Lab 1', time: '5 mins ago', read: false },
                                            { id: 2, type: 'admin', title: 'Faculty Meeting', message: 'Department
                                            meeting scheduled for tomorrow at 2 PM', time: '1 hour ago', read: false },
                                            { id: 3, type: 'system', title: 'Grade Deadline', message: 'Please submit
                                            final grades by December 15', time: '2 hours ago', read: true },
                                            { id: 4, type: 'student', title: 'Assignment Query', message: 'Sarah Wilson
                                            asked a question about Algorithm project', time: '3 hours ago', read: true
                                            },
                                            { id: 5, type: 'admin', title: 'New Policy Update', message: 'Updated
                                            attendance policy has been released', time: '1 day ago', read: true }
                                            ]);

                                            const todaySchedule = [
                                            { time: '09:00 AM', title: 'Data Structures Lecture', course: 'CSE-101',
                                            room: 'CS-201', type: 'class', batch: 'B.Tech CSE - 3rd Sem' },
                                            { time: '11:00 AM', title: 'Algorithms Lab', course: 'CSE-202', room:
                                            'CS-Lab-1', type: 'lab', batch: 'B.Tech CSE - 5th Sem' },
                                            { time: '02:00 PM', title: 'Faculty Meeting', course: 'Department', room:
                                            'Meeting Room', type: 'meeting', batch: '' },
                                            { time: '04:00 PM', title: 'Student Consultation', course: 'Office Hours',
                                            room: 'Faculty Room 12', type: 'consultation', batch: '' }
                                            ];

                                            const [grades, setGrades] = useState<Grade[]>([
                                                { studentId: 1, studentName: 'John Doe', rollNo: 'CSE001', course:
                                                'CSE-101', assignments: 45, midterm: 38, final: 85, total: 168, grade:
                                                'A' },
                                                { studentId: 2, studentName: 'Sarah Wilson', rollNo: 'CSE002', course:
                                                'CSE-101', assignments: 42, midterm: 35, final: 78, total: 155, grade:
                                                'B+' },
                                                { studentId: 3, studentName: 'Mike Johnson', rollNo: 'CSE003', course:
                                                'CSE-101', assignments: 48, midterm: 40, final: 90, total: 178, grade:
                                                'A+' },
                                                { studentId: 4, studentName: 'Emily Brown', rollNo: 'CSE004', course:
                                                'CSE-101', assignments: 40, midterm: 33, final: 75, total: 148, grade:
                                                'B' },
                                                { studentId: 5, studentName: 'David Lee', rollNo: 'CSE005', course:
                                                'CSE-101', assignments: 35, midterm: 28, final: 65, total: 128, grade:
                                                'C+' }
                                                ]);

                                                const stats = {
                                                totalStudents: 125,
                                                activeCourses: 4,
                                                pendingReviews: 43,
                                                upcomingClasses: 3,
                                                averageAttendance: 87.5
                                                };

                                                const generateQRCode = async () => {
                                                const qrData = {
                                                purpose: qrPurpose,
                                                course: selectedCourse,
                                                teacher: userInfo.name,
                                                timestamp: new Date().toISOString(),
                                                id: Math.random().toString(36).substr(2, 9)
                                                };

                                                try {
                                                const url = await QRCode.toDataURL(JSON.stringify(qrData), {
                                                width: 300,
                                                margin: 2,
                                                color: {
                                                dark: '#1e40af',
                                                light: '#ffffff'
                                                }
                                                });
                                                setQrCodeUrl(url);
                                                } catch (err) {
                                                console.error('Error generating QR code:', err);
                                                }
                                                };

                                                const downloadQRCode = () => {
                                                if (!qrCodeUrl) return;
                                                const link = document.createElement('a');
                                                link.download = `qr-${qrPurpose}-${selectedCourse}-${Date.now()}.png`;
                                                link.href = qrCodeUrl;
                                                link.click();
                                                };

                                                const menuItems = [
                                                { id: 'dashboard' as PageType, label: 'Dashboard', icon: LayoutDashboard
                                                },
                                                { id: 'qr-code' as PageType, label: 'Generate QR Code', icon: QrCode },
                                                { id: 'assignments' as PageType, label: 'Assignments', icon:
                                                ClipboardList },
                                                { id: 'schedule' as PageType, label: 'Today\'s Schedule', icon: Calendar
                                                },
                                                { id: 'grades' as PageType, label: 'Evaluation & Grades', icon:
                                                GraduationCap },
                                                { id: 'attendance-view' as PageType, label: 'View Attendance', icon:
                                                UserCheck },
                                                { id: 'settings' as PageType, label: 'Settings', icon: Settings }
                                                ];

                                                // Assignment modal handlers
                                                const handleCreateAssignment = () => {
                                                setAssignmentForm({
                                                title: '',
                                                batch: '',
                                                course: '',
                                                dueDate: '',
                                                description: '',
                                                fileName: ''
                                                });
                                                setIsCreateAssignmentOpen(true);
                                                };

                                                const handleEditAssignment = (assignment: Assignment) => {
                                                setSelectedAssignment(assignment);
                                                setAssignmentForm({
                                                title: assignment.title,
                                                batch: assignment.batch,
                                                course: assignment.course,
                                                dueDate: assignment.dueDate,
                                                description: assignment.description,
                                                fileName: assignment.fileName || ''
                                                });
                                                setIsEditAssignmentOpen(true);
                                                };

                                                const handleViewAssignment = (assignment: Assignment) => {
                                                setSelectedAssignment(assignment);
                                                setIsViewAssignmentOpen(true);
                                                };

                                                const handleDeleteAssignment = (id: number) => {
                                                if (confirm('Are you sure you want to delete this assignment?')) {
                                                setAssignments(assignments.filter(a => a.id !== id));
                                                }
                                                };

                                                const handleSaveAssignment = () => {
                                                if (selectedAssignment) {
                                                // Edit existing assignment
                                                setAssignments(assignments.map(a =>
                                                a.id === selectedAssignment.id
                                                ? { ...a, ...assignmentForm }
                                                : a
                                                ));
                                                setIsEditAssignmentOpen(false);
                                                } else {
                                                // Create new assignment
                                                const newAssignment: Assignment = {
                                                id: Math.max(...assignments.map(a => a.id)) + 1,
                                                ...assignmentForm,
                                                totalMarks: 100,
                                                submissions: 0,
                                                totalStudents: 35,
                                                status: 'active'
                                                };
                                                setAssignments([...assignments, newAssignment]);
                                                setIsCreateAssignmentOpen(false);
                                                }
                                                };

                                                const handleMarkAttendance = (item: any) => {
                                                setSelectedScheduleItem(item);
                                                setIsMarkAttendanceOpen(true);
                                                };

                                                const toggleAttendance = (studentId: number) => {
                                                setAttendanceList(attendanceList.map(student =>
                                                student.studentId === studentId
                                                ? { ...student, present: !student.present }
                                                : student
                                                ));
                                                };

                                                const submitAttendance = () => {
                                                // Here you would normally save to backend
                                                alert('Attendance saved successfully!');
                                                setIsMarkAttendanceOpen(false);
                                                setAttendanceList(attendanceList.map(student => ({ ...student, present:
                                                false })));
                                                };

                                                const getFilteredAssignments = () => {
                                                if (selectedBatch === 'all') return assignments;
                                                return assignments.filter(a => a.batch === selectedBatch);
                                                };

                                                const getBatchCourses = () => {
                                                if (selectedBatch === 'all') return courses;
                                                // Filter courses by batch (simplified - in real app would have
                                                batch-course mapping)
                                                return courses;
                                                };

                                                const renderDashboard = () => (
                                                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0
                                                    }} transition={{ duration: 0.3 }} className="space-y-6">
                                                    {/* Profile Section */}
                                                    <div className="grid lg:grid-cols-3 gap-6">
                                                        {/* Profile Card */}
                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex flex-col items-center text-center">
                                                                    <div
                                                                        className="size-32 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center text-white mb-4">
                                                                        <span className="text-5xl">PS</span>
                                                                    </div>
                                                                    <h3 className="text-xl mb-1">Dr. Priya Sharma</h3>
                                                                    <p className="text-muted-foreground mb-1">Assistant
                                                                        Professor</p>
                                                                    <p className="text-sm text-muted-foreground">
                                                                        Computer Science & Engineering</p>

                                                                    <div
                                                                        className="flex items-center justify-around w-full mt-6 pt-6 border-t">
                                                                        <div className="text-center">
                                                                            <p className="text-3xl text-purple-600">6
                                                                            </p>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Courses</p>
                                                                        </div>
                                                                        <div className="text-center">
                                                                            <p className="text-3xl text-purple-600">450
                                                                            </p>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Students</p>
                                                                        </div>
                                                                        <div className="text-center">
                                                                            <p className="text-3xl text-purple-600">12
                                                                            </p>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Years</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>

                                                        {/* Professional Information */}
                                                        <Card className="lg:col-span-2">
                                                            <CardHeader>
                                                                <CardTitle>Professional Information</CardTitle>
                                                            </CardHeader>
                                                            <CardContent>
                                                                <div className="grid md:grid-cols-2 gap-4">
                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <Mail className="size-5 text-blue-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Email Address</p>
                                                                            <p className="text-sm">
                                                                                priya.sharma@ecb.ac.in</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-cyan-50 dark:bg-cyan-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <Phone className="size-5 text-cyan-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Phone Number</p>
                                                                            <p className="text-sm">+91 9876543220</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <GraduationCap
                                                                                className="size-5 text-blue-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Qualification</p>
                                                                            <p className="text-sm">PhD in Computer
                                                                                Science</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <BookOpen
                                                                                className="size-5 text-green-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Specialization</p>
                                                                            <p className="text-sm">Artificial
                                                                                Intelligence & Machine Learning</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-orange-50 dark:bg-orange-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <Briefcase
                                                                                className="size-5 text-orange-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Experience</p>
                                                                            <p className="text-sm">12 years</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-pink-50 dark:bg-pink-950 rounded-lg">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <Calendar
                                                                                className="size-5 text-pink-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Joining Date</p>
                                                                            <p className="text-sm">August 2012</p>
                                                                        </div>
                                                                    </div>

                                                                    <div
                                                                        className="flex items-center gap-3 p-3 bg-purple-50 dark:bg-purple-950 rounded-lg md:col-span-2">
                                                                        <div
                                                                            className="p-2 bg-white dark:bg-gray-800 rounded-lg">
                                                                            <MapPin
                                                                                className="size-5 text-purple-600" />
                                                                        </div>
                                                                        <div>
                                                                            <p
                                                                                className="text-xs text-muted-foreground">
                                                                                Cabin Location</p>
                                                                            <p className="text-sm">Room 205, CSE Block
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>
                                                    </div>

                                                    {/* Courses Teaching Section */}
                                                    <Card>
                                                        <CardHeader>
                                                            <CardTitle>Courses Teaching (Current Semester)</CardTitle>
                                                        </CardHeader>
                                                        <CardContent>
                                                            <div className="grid md:grid-cols-3 gap-4">
                                                                <div
                                                                    className="p-4 bg-purple-50 dark:bg-purple-950 rounded-lg">
                                                                    <h4 className="font-medium mb-1">Data Structures
                                                                    </h4>
                                                                    <p className="text-sm text-muted-foreground mb-2">
                                                                        B.Tech CSE - 3rd Sem</p>
                                                                    <p className="text-xs text-purple-600">75 Students
                                                                    </p>
                                                                </div>
                                                                <div
                                                                    className="p-4 bg-purple-50 dark:bg-purple-950 rounded-lg">
                                                                    <h4 className="font-medium mb-1">Algorithms</h4>
                                                                    <p className="text-sm text-muted-foreground mb-2">
                                                                        B.Tech CSE - 5th Sem</p>
                                                                    <p className="text-xs text-purple-600">68 Students
                                                                    </p>
                                                                </div>
                                                                <div
                                                                    className="p-4 bg-purple-50 dark:bg-purple-950 rounded-lg">
                                                                    <h4 className="font-medium mb-1">Artificial
                                                                        Intelligence</h4>
                                                                    <p className="text-sm text-muted-foreground mb-2">
                                                                        B.Tech CSE - 7th Sem</p>
                                                                    <p className="text-xs text-purple-600">52 Students
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </CardContent>
                                                    </Card>

                                                    {/* Stats Grid */}
                                                    <div
                                                        className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm text-muted-foreground">
                                                                            Total Students</p>
                                                                        <p className="text-2xl mt-1">
                                                                            {stats.totalStudents}</p>
                                                                    </div>
                                                                    <div
                                                                        className="p-3 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                                                        <Users
                                                                            className="size-6 text-blue-600 dark:text-blue-300" />
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>

                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm text-muted-foreground">
                                                                            Active Courses</p>
                                                                        <p className="text-2xl mt-1">
                                                                            {stats.activeCourses}</p>
                                                                    </div>
                                                                    <div
                                                                        className="p-3 bg-green-100 dark:bg-green-900 rounded-lg">
                                                                        <BookOpen
                                                                            className="size-6 text-green-600 dark:text-green-300" />
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>

                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm text-muted-foreground">
                                                                            Pending Reviews</p>
                                                                        <p className="text-2xl mt-1">
                                                                            {stats.pendingReviews}</p>
                                                                    </div>
                                                                    <div
                                                                        className="p-3 bg-orange-100 dark:bg-orange-900 rounded-lg">
                                                                        <ClipboardList
                                                                            className="size-6 text-orange-600 dark:text-orange-300" />
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>

                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm text-muted-foreground">
                                                                            Classes Today</p>
                                                                        <p className="text-2xl mt-1">
                                                                            {stats.upcomingClasses}</p>
                                                                    </div>
                                                                    <div
                                                                        className="p-3 bg-purple-100 dark:bg-purple-900 rounded-lg">
                                                                        <Calendar
                                                                            className="size-6 text-purple-600 dark:text-purple-300" />
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>

                                                        <Card>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <p className="text-sm text-muted-foreground">Avg
                                                                            Attendance</p>
                                                                        <p className="text-2xl mt-1">
                                                                            {stats.averageAttendance}%</p>
                                                                    </div>
                                                                    <div
                                                                        className="p-3 bg-cyan-100 dark:bg-cyan-900 rounded-lg">
                                                                        <TrendingUp
                                                                            className="size-6 text-cyan-600 dark:text-cyan-300" />
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>
                                                    </div>

                                                    <div className="grid lg:grid-cols-2 gap-6">
                                                        {/* Today's Schedule */}
                                                        <Card>
                                                            <CardHeader>
                                                                <CardTitle className="flex items-center gap-2">
                                                                    <Calendar className="size-5" />
                                                                    Today's Schedule
                                                                </CardTitle>
                                                                <CardDescription>Your classes and meetings for today
                                                                </CardDescription>
                                                            </CardHeader>
                                                            <CardContent>
                                                                <div className="space-y-3">
                                                                    {todaySchedule.slice(0, 3).map((item, index) => (
                                                                    <div key={index}
                                                                        className="flex items-start gap-4 p-3 bg-muted rounded-lg">
                                                                        <div className="flex flex-col items-center">
                                                                            <Clock
                                                                                className="size-4 text-muted-foreground mb-1" />
                                                                            <span
                                                                                className="text-xs text-muted-foreground">{item.time}</span>
                                                                        </div>
                                                                        <div className="flex-1">
                                                                            <p className="font-medium">{item.title}</p>
                                                                            <p
                                                                                className="text-sm text-muted-foreground">
                                                                                {item.course}  {item.room}</p>
                                                                        </div>
                                                                        <Badge variant={ item.type==='class' ? 'default'
                                                                            : item.type==='lab' ? 'secondary' :
                                                                            item.type==='meeting' ? 'outline'
                                                                            : 'secondary' }>
                                                                            {item.type}
                                                                        </Badge>
                                                                    </div>
                                                                    ))}
                                                                </div>
                                                                <Button variant="outline" className="w-full mt-4"
                                                                    onClick={()=> setCurrentPage('schedule')}>
                                                                    View Full Schedule
                                                                </Button>
                                                            </CardContent>
                                                        </Card>

                                                        {/* Quick Actions */}
                                                        <Card>
                                                            <CardHeader>
                                                                <CardTitle>Quick Actions</CardTitle>
                                                                <CardDescription>Frequently used features
                                                                </CardDescription>
                                                            </CardHeader>
                                                            <CardContent>
                                                                <div className="grid grid-cols-2 gap-4">
                                                                    <Button variant="outline"
                                                                        className="h-20 flex flex-col gap-2"
                                                                        onClick={()=> setCurrentPage('qr-code')}>
                                                                        <QrCode className="size-6" />
                                                                        Generate QR
                                                                    </Button>
                                                                    <Button variant="outline"
                                                                        className="h-20 flex flex-col gap-2"
                                                                        onClick={()=> setCurrentPage('assignments')}>
                                                                        <Plus className="size-6" />
                                                                        New Assignment
                                                                    </Button>
                                                                    <Button variant="outline"
                                                                        className="h-20 flex flex-col gap-2"
                                                                        onClick={()=> setCurrentPage('grades')}>
                                                                        <BarChart3 className="size-6" />
                                                                        View Grades
                                                                    </Button>
                                                                    <Button variant="outline"
                                                                        className="h-20 flex flex-col gap-2"
                                                                        onClick={()=> setCurrentPage('schedule')}>
                                                                        <Clock className="size-6" />
                                                                        Schedule
                                                                    </Button>
                                                                </div>
                                                            </CardContent>
                                                        </Card>
                                                    </div>
                                                </motion.div>
                                                );

                                                const renderQRCode = () => (
                                                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0
                                                    }} transition={{ duration: 0.3 }}>
                                                    <Card>
                                                        <CardHeader>
                                                            <CardTitle>Generate QR Code</CardTitle>
                                                            <CardDescription>Create QR codes for attendance,
                                                                assignments, or resources</CardDescription>
                                                        </CardHeader>
                                                        <CardContent className="space-y-6">
                                                            <div className="grid md:grid-cols-2 gap-6">
                                                                <div className="space-y-4">
                                                                    <div className="space-y-2">
                                                                        <Label>Purpose</Label>
                                                                        <Select value={qrPurpose} onValueChange={(v:
                                                                            any)=> setQrPurpose(v)}>
                                                                            <SelectTrigger>
                                                                                <SelectValue />
                                                                            </SelectTrigger>
                                                                            <SelectContent>
                                                                                <SelectItem value="attendance">
                                                                                    Attendance</SelectItem>
                                                                                <SelectItem value="assignment">
                                                                                    Assignment</SelectItem>
                                                                                <SelectItem value="resource">Resource
                                                                                </SelectItem>
                                                                            </SelectContent>
                                                                        </Select>
                                                                    </div>

                                                                    <div className="space-y-2">
                                                                        <Label>Course</Label>
                                                                        <Select value={selectedCourse}
                                                                            onValueChange={setSelectedCourse}>
                                                                            <SelectTrigger>
                                                                                <SelectValue />
                                                                            </SelectTrigger>
                                                                            <SelectContent>
                                                                                {courses.map(course => (
                                                                                <SelectItem key={course.id}
                                                                                    value={course.code}>
                                                                                    {course.code} - {course.name}
                                                                                </SelectItem>
                                                                                ))}
                                                                            </SelectContent>
                                                                        </Select>
                                                                    </div>

                                                                    <div className="flex gap-2">
                                                                        <Button onClick={generateQRCode}
                                                                            className="flex-1">
                                                                            <QrCode className="size-4 mr-2" />
                                                                            Generate QR Code
                                                                        </Button>
                                                                        {qrCodeUrl && (
                                                                        <Button onClick={downloadQRCode}
                                                                            variant="outline">
                                                                            <Download className="size-4 mr-2" />
                                                                            Download
                                                                        </Button>
                                                                        )}
                                                                    </div>

                                                                    <div className="p-4 bg-muted rounded-lg">
                                                                        <h4 className="font-medium mb-2">QR Code Details
                                                                        </h4>
                                                                        <div
                                                                            className="space-y-1 text-sm text-muted-foreground">
                                                                            <p>Purpose: <span
                                                                                    className="text-foreground">{qrPurpose}</span>
                                                                            </p>
                                                                            <p>Course: <span
                                                                                    className="text-foreground">{selectedCourse}</span>
                                                                            </p>
                                                                            <p>Teacher: <span
                                                                                    className="text-foreground">{userInfo.name}</span>
                                                                            </p>
                                                                            <p>Valid Until: <span
                                                                                    className="text-foreground">End of
                                                                                    class</span></p>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div
                                                                    className="flex flex-col items-center justify-center p-6 bg-muted rounded-lg">
                                                                    {qrCodeUrl ? (
                                                                    <div className="space-y-4 text-center">
                                                                        <img src={qrCodeUrl} alt="QR Code"
                                                                            className="w-64 h-64 mx-auto" />
                                                                        <p className="text-sm text-muted-foreground">
                                                                            Scan this QR code for {qrPurpose}</p>
                                                                    </div>
                                                                    ) : (
                                                                    <div className="text-center">
                                                                        <QrCode
                                                                            className="size-24 text-muted-foreground mx-auto mb-4" />
                                                                        <p className="text-muted-foreground">Generate a
                                                                            QR code to see it here</p>
                                                                    </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </CardContent>
                                                    </Card>
                                                </motion.div>
                                                );

                                                const renderAssignments = () => (
                                                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0
                                                    }} transition={{ duration: 0.3 }} className="space-y-6">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <h2 className="text-2xl">Assignments</h2>
                                                            <p className="text-muted-foreground">Manage and track
                                                                student assignments</p>
                                                        </div>
                                                        <Button onClick={handleCreateAssignment}>
                                                            <Plus className="size-4 mr-2" />
                                                            Create Assignment
                                                        </Button>
                                                    </div>

                                                    <div className="flex gap-4">
                                                        <div className="flex-1 relative">
                                                            <Search
                                                                className="absolute left-3 top-1/2 transform -translate-y-1/2 size-4 text-muted-foreground" />
                                                            <Input placeholder="Search assignments..."
                                                                className="pl-10" />
                                                        </div>
                                                        <Select value={selectedBatch} onValueChange={setSelectedBatch}>
                                                            <SelectTrigger className="w-64">
                                                                <SelectValue placeholder="Select Batch" />
                                                            </SelectTrigger>
                                                            <SelectContent>
                                                                <SelectItem value="all">All Batches</SelectItem>
                                                                {batches.map(batch => (
                                                                <SelectItem key={batch} value={batch}>{batch}
                                                                </SelectItem>
                                                                ))}
                                                            </SelectContent>
                                                        </Select>
                                                    </div>

                                                    <div className="grid gap-4">
                                                        {getFilteredAssignments().map((assignment) => (
                                                        <Card key={assignment.id}>
                                                            <CardContent className="p-6">
                                                                <div className="flex items-start justify-between">
                                                                    <div className="flex-1">
                                                                        <div className="flex items-center gap-3 mb-2">
                                                                            <h3 className="text-lg font-medium">
                                                                                {assignment.title}</h3>
                                                                            <Badge variant={
                                                                                assignment.status==='active' ? 'default'
                                                                                : assignment.status==='closed'
                                                                                ? 'secondary' : 'outline' }>
                                                                                {assignment.status}
                                                                            </Badge>
                                                                        </div>
                                                                        <p
                                                                            className="text-sm text-muted-foreground mb-4">
                                                                            {assignment.description}</p>

                                                                        <div
                                                                            className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
                                                                            <div>
                                                                                <p
                                                                                    className="text-xs text-muted-foreground">
                                                                                    Batch</p>
                                                                                <p className="text-sm font-medium">
                                                                                    {assignment.batch}</p>
                                                                            </div>
                                                                            <div>
                                                                                <p
                                                                                    className="text-xs text-muted-foreground">
                                                                                    Course</p>
                                                                                <p className="text-sm font-medium">
                                                                                    {assignment.course}</p>
                                                                            </div>
                                                                            <div>
                                                                                <p
                                                                                    className="text-xs text-muted-foreground">
                                                                                    Due Date</p>
                                                                                <p className="text-sm font-medium">
                                                                                    {assignment.dueDate}</p>
                                                                            </div>
                                                                            <div>
                                                                                <p
                                                                                    className="text-xs text-muted-foreground">
                                                                                    Total Marks</p>
                                                                                <p className="text-sm font-medium">
                                                                                    {assignment.totalMarks}</p>
                                                                            </div>
                                                                            <div>
                                                                                <p
                                                                                    className="text-xs text-muted-foreground">
                                                                                    Submissions</p>
                                                                                <p className="text-sm font-medium">
                                                                                    {assignment.submissions}/{assignment.totalStudents}
                                                                                </p>
                                                                            </div>
                                                                        </div>

                                                                        <div className="mb-2">
                                                                            <div
                                                                                className="flex items-center justify-between text-xs text-muted-foreground mb-1">
                                                                                <span>Submission Progress</span>
                                                                                <span>{Math.round((assignment.submissions
                                                                                    / assignment.totalStudents) *
                                                                                    100)}%</span>
                                                                            </div>
                                                                            <div
                                                                                className="w-full bg-muted rounded-full h-2">
                                                                                <div className="bg-blue-600 h-2 rounded-full transition-all"
                                                                                    style={{ width:
                                                                                    `${(assignment.submissions /
                                                                                    assignment.totalStudents) * 100}%`
                                                                                    }} />
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div className="flex gap-2 ml-4">
                                                                        <Button variant="outline" size="sm"
                                                                            onClick={()=>
                                                                            handleViewAssignment(assignment)}>
                                                                            <Eye className="size-4 mr-1" />
                                                                            View
                                                                        </Button>
                                                                        <Button variant="outline" size="sm"
                                                                            onClick={()=>
                                                                            handleEditAssignment(assignment)}>
                                                                            <Edit className="size-4 mr-1" />
                                                                            Edit
                                                                        </Button>
                                                                        <Button variant="outline" size="sm"
                                                                            onClick={()=>
                                                                            handleDeleteAssignment(assignment.id)}>
                                                                            <Trash2 className="size-4 text-red-600" />
                                                                        </Button>
                                                                    </div>
                                                                </div>
                                                            </CardContent>
                                                        </Card>
                                                        ))}
                                                    </div>

                                                    {/* Create/Edit Assignment Modal */}
                                                    <Dialog open={isCreateAssignmentOpen || isEditAssignmentOpen}
                                                        onOpenChange={(open)=> {
                                                        setIsCreateAssignmentOpen(false);
                                                        setIsEditAssignmentOpen(false);
                                                        }}>
                                                        <DialogContent className="max-w-2xl">
                                                            <DialogHeader>
                                                                <DialogTitle>{isEditAssignmentOpen ? 'Edit Assignment' :
                                                                    'Create Assignment'}</DialogTitle>
                                                                <DialogDescription>
                                                                    Fill in the assignment details below
                                                                </DialogDescription>
                                                            </DialogHeader>
                                                            <div className="space-y-4">
                                                                <div className="space-y-2">
                                                                    <Label>Assignment Name</Label>
                                                                    <Input placeholder="Enter assignment name"
                                                                        value={assignmentForm.title} onChange={(e)=>
                                                                    setAssignmentForm({ ...assignmentForm, title:
                                                                    e.target.value })}
                                                                    />
                                                                </div>

                                                                <div className="grid grid-cols-2 gap-4">
                                                                    <div className="space-y-2">
                                                                        <Label>Batch</Label>
                                                                        <Select value={assignmentForm.batch}
                                                                            onValueChange={(v)=> setAssignmentForm({
                                                                            ...assignmentForm, batch: v })}>
                                                                            <SelectTrigger>
                                                                                <SelectValue
                                                                                    placeholder="Select Batch" />
                                                                            </SelectTrigger>
                                                                            <SelectContent>
                                                                                {batches.map(batch => (
                                                                                <SelectItem key={batch} value={batch}>
                                                                                    {batch}</SelectItem>
                                                                                ))}
                                                                            </SelectContent>
                                                                        </Select>
                                                                    </div>

                                                                    <div className="space-y-2">
                                                                        <Label>Course</Label>
                                                                        <Select value={assignmentForm.course}
                                                                            onValueChange={(v)=> setAssignmentForm({
                                                                            ...assignmentForm, course: v })}>
                                                                            <SelectTrigger>
                                                                                <SelectValue
                                                                                    placeholder="Select Course" />
                                                                            </SelectTrigger>
                                                                            <SelectContent>
                                                                                {getBatchCourses().map(course => (
                                                                                <SelectItem key={course.id}
                                                                                    value={course.name}>{course.name}
                                                                                </SelectItem>
                                                                                ))}
                                                                            </SelectContent>
                                                                        </Select>
                                                                    </div>
                                                                </div>

                                                                <div className="space-y-2">
                                                                    <Label>Due Date</Label>
                                                                    <Input type="date" value={assignmentForm.dueDate}
                                                                        onChange={(e)=> setAssignmentForm({
                                                                    ...assignmentForm, dueDate: e.target.value })}
                                                                    />
                                                                </div>

                                                                <div className="space-y-2">
                                                                    <Label>Description</Label>
                                                                    <Textarea placeholder="Enter assignment description"
                                                                        value={assignmentForm.description}
                                                                        onChange={(e)=> setAssignmentForm({ ...assignmentForm, description: e.target.value })}
                rows={3}
              />
            </div>
            
            <div className="space-y-2">
              <Label>Upload File (Drag and Drop)</Label>
              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center hover:border-muted-foreground/50 transition-colors cursor-pointer">
                <Upload className="size-8 text-muted-foreground mx-auto mb-2" />
                <p className="text-sm text-muted-foreground">Drop files here or click to upload</p>
                <p className="text-xs text-muted-foreground mt-1">PDF, DOC, DOCX up to 10MB</p>
                {assignmentForm.fileName && (
                  <p className="text-sm text-blue-600 mt-2"> {assignmentForm.fileName}</p>
                )}
              </div>
            </div>
            
            <div className="flex gap-2 justify-end">
              <Button variant="outline" onClick={() => {
                setIsCreateAssignmentOpen(false);
                setIsEditAssignmentOpen(false);
              }}>
                Cancel
              </Button>
              <Button onClick={handleSaveAssignment}>
                {isEditAssignmentOpen ? 'Update' : 'Create'} Assignment
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* View Assignment Modal */}
      <Dialog open={isViewAssignmentOpen} onOpenChange={setIsViewAssignmentOpen}>
        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>{selectedAssignment?.title}</DialogTitle>
            <DialogDescription>
              Student Submission Analysis
            </DialogDescription>
          </DialogHeader>
          
          <div className="space-y-4">
            <div className="grid grid-cols-3 gap-4">
              <Card>
                <CardContent className="p-4">
                  <p className="text-sm text-muted-foreground">Total Students</p>
                  <p className="text-2xl">{selectedAssignment?.totalStudents}</p>
                </CardContent>
              </Card>
              <Card>
                <CardContent className="p-4">
                  <p className="text-sm text-muted-foreground">Submitted</p>
                  <p className="text-2xl text-green-600">{selectedAssignment?.submissions}</p>
                </CardContent>
              </Card>
              <Card>
                <CardContent className="p-4">
                  <p className="text-sm text-muted-foreground">Pending</p>
                  <p className="text-2xl text-orange-600">
                    {(selectedAssignment?.totalStudents || 0) - (selectedAssignment?.submissions || 0)}
                  </p>
                </CardContent>
              </Card>
            </div>

            <div className="border rounded-lg overflow-hidden">
              <table className="w-full">
                <thead className="bg-muted">
                  <tr>
                    <th className="px-4 py-3 text-left text-sm font-medium">Roll No</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">Student Name</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">Email</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">Status</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">Submission Date</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">File</th>
                    <th className="px-4 py-3 text-right text-sm font-medium">Marks</th>
                  </tr>
                </thead>
                <tbody className="divide-y">
                  {studentSubmissions.map((student) => (
                    <tr key={student.studentId} className="hover:bg-muted/50">
                      <td className="px-4 py-3 text-sm">{student.rollNo}</td>
                      <td className="px-4 py-3">
                        <p className="font-medium">{student.studentName}</p>
                      </td>
                      <td className="px-4 py-3 text-sm text-muted-foreground">{student.email}</td>
                      <td className="px-4 py-3">
                        {student.submitted ? (
                          <Badge className="bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">
                            <CheckCircle className="size-3 mr-1" />
                            Submitted
                          </Badge>
                        ) : (
                          <Badge variant="outline" className="text-orange-600 border-orange-600">
                            <XCircle className="size-3 mr-1" />
                            Pending
                          </Badge>
                        )}
                      </td>
                      <td className="px-4 py-3 text-sm">{student.submissionDate || '-'}</td>
                      <td className="px-4 py-3 text-sm">
                        {student.fileName ? (
                          <Button variant="ghost" size="sm">
                            <FileText className="size-4 mr-1" />
                            View
                          </Button>
                        ) : '-'}
                      </td>
                      <td className="px-4 py-3 text-right">
                        {student.marks !== undefined ? (
                          <span className="font-medium">{student.marks}/50</span>
                        ) : '-'}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </motion.div>
  );

  const renderSchedule = () => (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.3 }}
    >
      <Card>
        <CardHeader>
          <CardTitle>Today's Schedule</CardTitle>
          <CardDescription>Your complete timetable for {new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {todaySchedule.map((item, index) => (
              <div key={index} className="flex items-center gap-4 p-4 border rounded-lg hover:bg-muted transition-colors">
                <div className="flex flex-col items-center min-w-[80px]">
                  <Clock className="size-5 text-muted-foreground mb-1" />
                  <span className="font-medium">{item.time}</span>
                </div>
                <div className="flex-1">
                  <h4 className="font-medium text-lg">{item.title}</h4>
                  <p className="text-sm text-muted-foreground">{item.course}</p>
                  <div className="flex items-center gap-2 mt-1">
                    <MapPin className="size-3 text-muted-foreground" />
                    <span className="text-xs text-muted-foreground">{item.room}</span>
                  </div>
                </div>
                <Badge variant={
                  item.type === 'class' ? 'default' : 
                  item.type === 'lab' ? 'secondary' : 
                  item.type === 'meeting' ? 'outline' : 'secondary'
                }>
                  {item.type}
                </Badge>
                {item.type === 'class' || item.type === 'lab' ? (
                  <Button variant="outline" size="sm" onClick={() => handleMarkAttendance(item)}>
                    <Users className="size-4 mr-1" />
                    Mark Manual
                  </Button>
                ) : null}
              </div>
            ))}
          </div>

          <div className="mt-6 p-4 bg-muted rounded-lg">
            <h4 className="font-medium mb-2">Weekly Overview</h4>
            <div className="grid grid-cols-5 gap-2 text-center">
              {['Mon', 'Tue', 'Wed', 'Thu', 'Fri'].map((day) => (
                <div key={day} className="p-2 bg-background rounded">
                  <p className="text-xs text-muted-foreground mb-1">{day}</p>
                  <p className="text-lg font-medium">{Math.floor(Math.random() * 3) + 2}</p>
                  <p className="text-xs text-muted-foreground">classes</p>
                </div>
              ))}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Mark Attendance Modal */}
      <Dialog open={isMarkAttendanceOpen} onOpenChange={setIsMarkAttendanceOpen}>
        <DialogContent className="max-w-3xl max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>Mark Attendance - {selectedScheduleItem?.title}</DialogTitle>
            <DialogDescription>
              {selectedScheduleItem?.batch}  {selectedScheduleItem?.room}  {selectedScheduleItem?.time}
            </DialogDescription>
          </DialogHeader>
          
          <div className="space-y-4">
            <div className="flex items-center justify-between p-4 bg-muted rounded-lg">
              <div>
                <p className="text-sm text-muted-foreground">Total Students</p>
                <p className="text-2xl">{attendanceList.length}</p>
              </div>
              <div>
                <p className="text-sm text-muted-foreground">Present</p>
                <p className="text-2xl text-green-600">{attendanceList.filter(s => s.present).length}</p>
              </div>
              <div>
                <p className="text-sm text-muted-foreground">Absent</p>
                <p className="text-2xl text-red-600">{attendanceList.filter(s => !s.present).length}</p>
              </div>
              <Button variant="outline" size="sm" onClick={() => 
                setAttendanceList(attendanceList.map(s => ({ ...s, present: true })))
              }>
                Mark All Present
              </Button>
            </div>

            <div className="border rounded-lg overflow-hidden">
              <table className="w-full">
                <thead className="bg-muted">
                  <tr>
                    <th className="px-4 py-3 text-left text-sm font-medium">Roll No</th>
                    <th className="px-4 py-3 text-left text-sm font-medium">Student Name</th>
                    <th className="px-4 py-3 text-center text-sm font-medium">Attendance</th>
                  </tr>
                </thead>
                <tbody className="divide-y">
                  {attendanceList.map((student) => (
                    <tr key={student.studentId} className="hover:bg-muted/50">
                      <td className="px-4 py-3 text-sm font-medium">{student.rollNo}</td>
                      <td className="px-4 py-3">{student.studentName}</td>
                      <td className="px-4 py-3 text-center">
                        <div className="flex items-center justify-center gap-4">
                          <Button
                            size="sm"
                            variant={student.present ? 'default' : 'outline'}
                            className={student.present ? 'bg-green-600 hover:bg-green-700' : ''}
                            onClick={() => {
                              if (!student.present) toggleAttendance(student.studentId);
                            }}
                          >
                            <CheckCircle className="size-4 mr-1" />
                            Present
                          </Button>
                          <Button
                            size="sm"
                            variant={!student.present ? 'destructive' : 'outline'}
                            onClick={() => {
                              if (student.present) toggleAttendance(student.studentId);
                            }}
                          >
                            <XCircle className="size-4 mr-1" />
                            Absent
                          </Button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <div className="flex gap-2 justify-end">
              <Button variant="outline" onClick={() => setIsMarkAttendanceOpen(false)}>
                Cancel
              </Button>
              <Button onClick={submitAttendance}>
                Save Attendance
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </motion.div>
  );

  const renderGrades = () => (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.3 }}
      className="space-y-6"
    >
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl">Evaluation & Grades</h2>
          <p className="text-muted-foreground">View and manage student grades</p>
        </div>
        <div className="flex gap-2">
          <Select defaultValue="CSE-101">
            <SelectTrigger className="w-48">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              {courses.map(course => (
                <SelectItem key={course.id} value={course.code}>
                  {course.code}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          <Button variant="outline">
            <Download className="size-4 mr-2" />
            Export
          </Button>
        </div>
      </div>

      <Card>
        <CardContent className="p-0">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-muted">
                <tr>
                  <th className="px-4 py-3 text-left text-sm font-medium">Student</th>
                  <th className="px-4 py-3 text-left text-sm font-medium">Roll No</th>
                  <th className="px-4 py-3 text-right text-sm font-medium">Assignments (50)</th>
                  <th className="px-4 py-3 text-right text-sm font-medium">Midterm (40)</th>
                  <th className="px-4 py-3 text-right text-sm font-medium">Final (100)</th>
                  <th className="px-4 py-3 text-right text-sm font-medium">Total (190)</th>
                  <th className="px-4 py-3 text-center text-sm font-medium">Grade</th>
                </tr>
              </thead>
              <tbody className="divide-y">
                {grades.map((grade) => (
                  <tr key={grade.studentId} className="hover:bg-muted/50">
                    <td className="px-4 py-3">
                      <p className="font-medium">{grade.studentName}</p>
                    </td>
                    <td className="px-4 py-3 text-sm text-muted-foreground">{grade.rollNo}</td>
                    <td className="px-4 py-3 text-right">{grade.assignments}</td>
                    <td className="px-4 py-3 text-right">{grade.midterm}</td>
                    <td className="px-4 py-3 text-right">{grade.final}</td>
                    <td className="px-4 py-3 text-right font-medium">{grade.total}</td>
                    <td className="px-4 py-3 text-center">
                      <Badge variant={
                        grade.grade.includes('A') ? 'default' :
                        grade.grade.includes('B') ? 'secondary' :
                        'outline'
                      }>
                        {grade.grade}
                      </Badge>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </CardContent>
      </Card>

      <div className="grid md:grid-cols-3 gap-4">
        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Grade Distribution</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2">
              {['A+', 'A', 'B+', 'B', 'C+'].map((grade, idx) => (
                <div key={grade} className="flex items-center justify-between">
                  <span className="text-sm">{grade}</span>
                  <div className="flex items-center gap-2 flex-1 ml-4">
                    <div className="flex-1 bg-muted rounded-full h-2">
                      <div 
                        className="bg-blue-600 h-2 rounded-full"
                        style={{ width: `${[60, 20, 10, 5, 5][idx]}%` }}
                      />
                    </div>
                    <span className="text-sm text-muted-foreground">{[3, 1, 1, 0, 0][idx]}</span>
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Class Statistics</CardTitle>
          </CardHeader>
          <CardContent className="space-y-3">
            <div>
              <p className="text-sm text-muted-foreground">Average Score</p>
              <p className="text-2xl font-medium">155.4 / 190</p>
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Highest Score</p>
              <p className="text-2xl font-medium">178</p>
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Pass Rate</p>
              <p className="text-2xl font-medium">100%</p>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Recent Activity</CardTitle>
          </CardHeader>
          <CardContent className="space-y-3">
            <div className="text-sm">
              <p className="font-medium">Grades Updated</p>
              <p className="text-muted-foreground">Final exam grades posted</p>
              <p className="text-xs text-muted-foreground mt-1">2 hours ago</p>
            </div>
            <div className="text-sm">
              <p className="font-medium">Assignment Graded</p>
              <p className="text-muted-foreground">Lab 1 evaluation complete</p>
              <p className="text-xs text-muted-foreground mt-1">1 day ago</p>
            </div>
          </CardContent>
        </Card>
      </div>
    </motion.div>
  );

  const renderSettings = () => (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.3 }}
      className="space-y-6"
    >
      <div>
        <h2 className="text-2xl">Settings</h2>
        <p className="text-muted-foreground">Manage your account and preferences</p>
      </div>

      <div className="grid lg:grid-cols-3 gap-6">
        <Card className="lg:col-span-2">
          <CardHeader>
            <CardTitle>Profile Information</CardTitle>
            <CardDescription>Update your personal details</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="grid md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Full Name</Label>
                <Input defaultValue={userInfo.name} />
              </div>
              <div className="space-y-2">
                <Label>Email</Label>
                <Input type="email" defaultValue={userInfo.email} />
              </div>
            </div>
            <div className="grid md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Phone</Label>
                <Input defaultValue="+91 9876543210" />
              </div>
              <div className="space-y-2">
                <Label>Department</Label>
                <Input defaultValue="Computer Science" />
              </div>
            </div>
            <div className="space-y-2">
              <Label>Bio</Label>
              <Textarea placeholder="Tell us about yourself..." rows={3} />
            </div>
            <Button>Save Changes</Button>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Preferences</CardTitle>
            <CardDescription>Customize your experience</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex items-center justify-between">
              <div>
                <p className="font-medium">Theme</p>
                <p className="text-sm text-muted-foreground">Choose your theme</p>
              </div>
              <Button
                variant="outline"
                size="sm"
                onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
              >
                {theme === 'light' ? <Moon className="size-4" /> : <Sun className="size-4" />}
              </Button>
            </div>
            
            <div className="flex items-center justify-between">
              <div>
                <p className="font-medium">Email Notifications</p>
                <p className="text-sm text-muted-foreground">Receive email updates</p>
              </div>
              <input type="checkbox" defaultChecked className="w-4 h-4" />
            </div>

            <div className="flex items-center justify-between">
              <div>
                <p className="font-medium">Push Notifications</p>
                <p className="text-sm text-muted-foreground">Get instant alerts</p>
              </div>
              <input type="checkbox" defaultChecked className="w-4 h-4" />
            </div>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>Security</CardTitle>
          <CardDescription>Manage your account security</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Label>Current Password</Label>
            <Input type="password" placeholder="Enter current password" />
          </div>
          <div className="grid md:grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label>New Password</Label>
              <Input type="password" placeholder="Enter new password" />
            </div>
            <div className="space-y-2">
              <Label>Confirm Password</Label>
              <Input type="password" placeholder="Confirm new password" />
            </div>
          </div>
          <Button>Update Password</Button>
        </CardContent>
      </Card>
    </motion.div>
  );

  const renderContent = () => {
    switch (currentPage) {
      case 'dashboard':
        return renderDashboard();
      case 'qr-code':
        return renderQRCode();
      case 'assignments':
        return renderAssignments();
      case 'schedule':
        return renderSchedule();
      case 'grades':
        return renderGrades();
      case 'settings':
        return renderSettings();
      default:
        return renderDashboard();
    }
  };

  return (
    <div className={theme === 'dark' ? 'dark' : ''}>
      <div className="min-h-screen bg-background">
        {/* Header */}
        <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur">
          <div className="flex h-16 items-center px-6 gap-4">
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setSidebarOpen(!sidebarOpen)}
              className="lg:hidden"
            >
              {sidebarOpen ? <CloseIcon className="size-5" /> : <Menu className="size-5" />}
            </Button>

            <div className="flex items-center gap-3">
              <div className="p-2 bg-blue-600 rounded-lg">
                <GraduationCap className="size-6 text-white" />
              </div>
              <div>
                <h1 className="font-semibold">Teacher Dashboard</h1>
                <p className="text-xs text-muted-foreground">{userInfo.institute}</p>
              </div>
            </div>

            <div className="ml-auto flex items-center gap-4">
              <Button variant="ghost" size="sm" className="relative">
                <Bell className="size-5" />
                {notifications.filter(n => !n.read).length > 0 && (
                  <span className="absolute -top-1 -right-1 size-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center">
                    {notifications.filter(n => !n.read).length}
                  </span>
                )}
              </Button>

              <Button
                variant="ghost"
                size="sm"
                onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
              >
                {theme === 'light' ? <Moon className="size-5" /> : <Sun className="size-5" />}
              </Button>

              <div className="flex items-center gap-3 px-3 py-2 rounded-lg bg-muted">
                <div className="size-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                  {userInfo.name.charAt(0)}
                </div>
                <div className="hidden md:block">
                  <p className="text-sm font-medium">{userInfo.name}</p>
                  <p className="text-xs text-muted-foreground">Professor</p>
                </div>
              </div>

              <Button variant="ghost" size="sm" onClick={onLogout}>
                <LogOut className="size-5" />
              </Button>
            </div>
          </div>
        </header>

        <div className="flex">
          {/* Sidebar */}
          <aside className={`${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 fixed lg:sticky top-16 z-40 h-[calc(100vh-4rem)] w-64 border-r bg-background transition-transform`}>
            <nav className="p-4 space-y-1">
              {menuItems.map((item) => (
                <button
                  key={item.id}
                  onClick={() => {
                    setCurrentPage(item.id);
                    if (window.innerWidth < 1024) setSidebarOpen(false);
                  }}
                  className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                    currentPage === item.id
                      ? 'bg-blue-600 text-white'
                      : 'hover:bg-muted'
                  }`}
                >
                  <item.icon className="size-5" />
                  <span>{item.label}</span>
                </button>
              ))}
            </nav>
          </aside>

          {/* Main Content */}
          <main className="flex-1 p-6 lg:p-8">
            {renderContent()}
          </main>
        </div>
      </div>
    </div>
  );
}